<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mural de Avisos</title>

<style>
/* ===== VISUAL ===== */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f5f5f5;
}

header {
  background: #1e3a8a;
  color: white;
  padding: 16px;
  text-align: center;
}

.turma-ativa {
  background: #e5e7eb;
  color: #000;
  padding: 6px;
  font-weight: bold;
  text-align: center;
}

.legenda, .filtros {
  text-align: center;
  padding: 10px;
  background: #f1f5f9;
}

.filtros button {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #e5e7eb;
}

#avisos {
  padding: 16px;
}

.aviso {
  background: #fff;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 6px;
  border-left: 6px solid #ccc;
}

.aviso-aviso { border-color: #1976d2; }
.aviso-reuniao { border-color: #2e7d32; }
.aviso-urgente { border-color: #d32f2f; background:#fff5f5; }

.aviso-geral {
  background: #eef2ff;
  border-left-style: dashed;
}

.aviso-geral::before {
  content: "ğŸ“Œ AVISO GERAL";
  display: block;
  font-size: 12px;
  font-weight: bold;
  color: #1e3a8a;
  margin-bottom: 6px;
}

/* ===== PORTAL ===== */
#portal {
  padding: 20px;
  text-align: center;
}

#portal .box {
  max-width: 320px;
  margin: 20px auto;
  background: white;
  padding: 16px;
  border-radius: 8px;
}
</style>
</head>

<body>

<!-- ===== PORTAL ===== -->
<div id="portal" style="display:none">
  <h2>IE Sarah Kubitschek</h2>
  <p>Portal de Avisos</p>

  <div class="box">
    <h3>ğŸ”’ Ãrea da Escola</h3>
    <input type="password" id="senhaPortal" placeholder="Digite a senha"
           style="width:100%; padding:8px;">
    <br><br>
    <button onclick="entrarMuralGeral()"
            style="width:100%; padding:10px; background:#1e3a8a; color:white; border:none; border-radius:6px;">
      Entrar no Mural Geral
    </button>
  </div>

  <div class="box">
    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Acesso dos ResponsÃ¡veis</h3>
    <a href="?turma=IFLGCH1001">Turma IFLGCH1001</a><br><br>
    <a href="?turma=IFLGCH1002">Turma IFLGCH1002</a>
  </div>
</div>

<!-- ===== MURAL ===== -->
<div id="mural" style="display:none">

<header>
  <h1>IE Sarah Kubitschek</h1>
  <p>Mural de Avisos</p>
</header>

<div class="turma-ativa"></div>

<div class="legenda">ğŸ“¢ Aviso &nbsp; ğŸ“… ReuniÃ£o &nbsp; âš ï¸ Urgente</div>

<div class="filtros">
  <button onclick="filtrar('todos')">Todos</button>
  <button onclick="filtrar('aviso')">Avisos</button>
  <button onclick="filtrar('reuniao')">ReuniÃµes</button>
  <button onclick="filtrar('urgente')">Urgentes</button>
</div>

<div id="avisos"></div>
</div>

<script>
/* ===== CONFIGURAÃ‡ÃƒO ===== */
const URL_API = "https://script.google.com/macros/s/AKfycbzWFhC2ELhi7dd3QkEvO4P1QSTy0-7l1lEON3cZv_dL1JV2qVWBe6d2d53-0nHCGOkLtg/exec";

const params = new URLSearchParams(window.location.search);
const turmaSelecionada = params.get("turma");

let avisos = [];
let filtroTipo = "todos";

/* ===== CONTROLE PORTAL ===== */
if (turmaSelecionada) {
  document.getElementById("mural").style.display = "block";
} else {
  document.getElementById("portal").style.display = "block";
}

function entrarMuralGeral() {
  if (document.getElementById("senhaPortal").value === "ESCOLA123") {
    document.getElementById("portal").style.display = "none";
    document.getElementById("mural").style.display = "block";
    renderizar();
  } else {
    alert("Senha incorreta");
  }
}

/* ===== DADOS ===== */
fetch(URL_API)
  .then(r => r.json())
  .then(dados => {
    avisos = dados;
    renderizar();
  });

/* ===== FILTROS ===== */
function filtrar(tipo) {
  filtroTipo = tipo;
  renderizar();
}

/* ===== RENDER ===== */
function renderizar() {
  if (!document.getElementById("mural").style.display) return;

  document.querySelector(".turma-ativa").innerText =
    turmaSelecionada ? `TURMA: ${turmaSelecionada}` : "MURAL GERAL";

  const div = document.getElementById("avisos");
  div.innerHTML = "";

  avisos
    .sort((a,b)=>new Date(b.Data)-new Date(a.Data))
    .filter(a=>{
      if (turmaSelecionada && a.Turma !== "GERAL" && a.Turma !== turmaSelecionada) return false;
      if (filtroTipo !== "todos" && a.Tipo !== filtroTipo) return false;
      return true;
    })
    .forEach(a=>{
      const box = document.createElement("div");
      box.className = `aviso aviso-${a.Tipo} ${a.Turma==="GERAL"?"aviso-geral":""}`;
      box.innerHTML = `<h3>${a.TÃ­tulo}</h3><p>${a.Mensagem}</p>`;
      div.appendChild(box);
    });
}
</script>

</body>
</html>
